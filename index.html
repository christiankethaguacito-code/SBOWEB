<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>Student Body Organization | SKSU Isulan Campus</title>
    <!-- Force load Google Analytics (gtag) immediately to ensure monitoring is active -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SDFV8LQ21J"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer.push(arguments);} 
        window.gtag = gtag;
        gtag('js', new Date());
    gtag('config', 'G-SDFV8LQ21J', { send_page_view: false, debug_mode: true });
        window._gtag_loaded = true;
        // If analytics was already set to enabled by the page, send a page_view now
        try {
            if (localStorage.getItem('sbo_analytics_consent_v1') === 'granted') {
                // prefer the page's trackPageView helper if present
                if (typeof window.trackPageView === 'function') {
                    window.trackPageView();
                } else if (typeof gtag === 'function') {
                    gtag('event', 'page_view', { page_path: window.location.pathname + window.location.search + window.location.hash, debug_mode: true });
                    console.debug('gtag page_view (forced):', window.location.href);
                }
            }
        } catch (e) { /* ignore localStorage errors */ }
    </script>
    <script src="scripts/analytics.js" defer></script>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- main styles moved to styles/main.css -->
</head>
<body>

    <header>
        <div class="nav-wrapper">
            <a class="brand" href="index.html" data-page="home" aria-label="Student Body Organization">
                <img src="logo.png" alt="SBO logo">
                <span>Student Body Organization</span>
            </a>
            <nav>
                <a href="index.html" data-page="home" data-no-active="true">Home</a>
                <a href="newsroom.html" data-page="newsroom">Newsroom</a>
                <a href="initiatives.html" data-page="initiatives">Evaluation</a>
                <a href="impact.html" data-page="impact">Impact</a>
                <a href="events.html" data-page="events">Events</a>
                <a href="officers.html" data-page="officers">Officers</a>
                <a href="connect.html" data-page="connect">Contact</a>
            </nav>
            <div class="nav-actions">
                <a class="call-to-action" href="sksumanual.pdf" download>Download Student Manual</a>
            </div>
        </div>
    </header>

    <main id="page-content" class="page-shell">

                <section id="feature-video" class="feature-video" aria-labelledby="feature-video-title">
                    <div class="feature-video-media">
                        <video
                            class="feature-video-player"
                            data-feature-embed
                            title="Student Body Organization feature reel"
                            controls
                            autoplay
                            muted
                            loop
                            playsinline
                            preload="metadata"
                            poster="group.jpg">
                            <source src="feature-web.mp4" type="video/mp4">
                            Your browser does not support inline video. Watch the feature reel using the download button below.
                        </video>
                        <div class="feature-video-fallback" data-feature-fallback hidden>
                            <img src="group.jpg" alt="Student Body Organization feature reel preview" loading="lazy">
                            <strong>Inline playback temporarily unavailable</strong>
                            <p>We are serving a lighter preview while the video loads. Use the button below to watch the complete cut.</p>
                        </div>
                    </div>
                    <div class="feature-video-caption">
                        <div class="container">
                            <span class="feature-video-badge">Feature Reel</span>
                            <h2 id="feature-video-title">Experience the SBO story in motion.</h2>
                            <p>Catch highlights from assemblies, community immersions, and student-led breakthroughs shaping the academic year.</p>
                            <a class="call-to-action" href="https://www.facebook.com/TheTechnopipeline" target="_blank" rel="noopener">Watch full video</a>
                        </div>
                    </div>
                </section>

                <section id="headlines" class="news-announcements" aria-labelledby="news-announcements-title">
                    <div class="container">
                        <div class="news-announcements-header">
                            <h2 id="news-announcements-title">News &amp; Announcements</h2>
                            <a class="ghost-button" href="newsroom.html" data-page="newsroom" data-no-active="true">Visit Newsroom</a>
                        </div>
                        <div class="news-announcements-grid">
                            <article class="news-column">
                                <h3>Notices</h3>
                                <ul class="news-list">
                                    <li>
                                        <a href="newsroom.html" data-page="newsroom" data-no-active="true">Midterm Examination Schedule, 1st Semester A.Y. 2025-2026</a>
                                        <span>September 27, 2025</span>
                                    </li>
                                    <li>
                                        <a href="events.html" data-page="events" data-no-active="true">Innovation Sprints registration opens for October 28</a>
                                        <span>October 12, 2025</span>
                                    </li>
                                </ul>
                            </article>
                            <article class="news-column">
                                <h3>Awards</h3>
                                <ul class="news-list">
                                    <li>
                                        <a href="newsroom.html" data-page="newsroom" data-no-active="true">Michael Abad ranks Top 2 in USG Senate race</a>
                                        <span>October 9, 2025</span>
                                    </li>
                                    <li>
                                        <a href="newsroom.html" data-page="newsroom" data-no-active="true">SBO Helpdesk earns campus service excellence citation</a>
                                        <span>September 29, 2025</span>
                                    </li>
                                </ul>
                            </article>
                            <article class="news-column">
                                <h3>Internationalization</h3>
                                <ul class="news-list">
                                    <li>
                                        <a href="initiatives.html" data-page="initiatives" data-no-active="true">Barangay Innovation Fellows deploy 12 community pilots</a>
                                        <span>August 2025</span>
                                    </li>
                                    <li>
                                        <a href="impact.html" data-page="impact" data-no-active="true">Transparency portal launches real-time budget dashboard</a>
                                        <span>September 2025</span>
                                    </li>
                                </ul>
                            </article>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-grid">
            <div>
                <div class="footer-brand">Student Body Organization</div>
                <p>Sultan Kudarat State University<br>Isulan Campus</p>
            </div>
            <div class="footer-links">
                <strong>Explore</strong>
                <a href="index.html" data-page="home" data-no-active="true">Home</a>
                <a href="index.html#feature-video" data-page="home" data-scroll-target="feature-video" data-no-active="true">Feature Reel</a>
                <a href="newsroom.html" data-page="newsroom" data-no-active="true">Newsroom</a>
                <a href="initiatives.html" data-page="initiatives" data-no-active="true">Evaluation</a>
                <a href="impact.html" data-page="impact" data-no-active="true">Impact</a>
                <a href="events.html" data-page="events" data-no-active="true">Events</a>
                <a href="officers.html" data-page="officers" data-no-active="true">Officers</a>
            </div>
            <div class="footer-links">
                <strong>Resources</strong>
                <a href="connect.html" data-page="connect" data-no-active="true">Contact SBO</a>
                <a href="https://www.facebook.com/SKSUSBO" target="_blank" rel="noopener">Facebook Page</a>
                <a href="https://www.instagram.com/" target="_blank" rel="noopener">Instagram</a>
                <a href="https://www.youtube.com/" target="_blank" rel="noopener">YouTube Channel</a>
                <a href="sksumanual.pdf" download>Student Manual (PDF)</a>
                <a href="downloads/sbo-app.txt" download>Download SBO App (guidance)</a>
            </div>
            <div class="footer-links">
                <strong>Visit</strong>
                <span>Learning Commons, 2nd floor</span>
                <a href="mailto:sksustudentbodyorganizationisu@gmail.com">sksustudentbodyorganizationisu@gmail.com</a>
                <a href="tel:+639497833448">09497833448</a>
            </div>
        </div>
        <div class="footer-bottom">
            <span>&copy; 2025 Student Body Organization, SKSU Isulan Campus. All rights reserved.</span>
            <span>Your partner in student leadership and community impact.</span>
        </div>
    </footer>

    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <script>
        const viewConfig = {
            home: { partial: 'partials/home.html' },
            newsroom: { partial: 'partials/newsroom.html' },
            initiatives: { partial: 'partials/initiatives.html' },
            impact: { partial: 'partials/impact.html' },
            events: { partial: 'partials/events.html' },
            officers: { partial: 'partials/officers.html' },
            connect: { partial: 'partials/connect.html' }
        };

        const homeSlides = [
            {
                tag: 'Student Leadership',
                title: 'SBO male officers lead the charge',
                excerpt: 'Meet the core leaders coordinating college councils and strategic programs for the 2025 term.',
                image: 'group.jpg',
                link: 'index.html#feature-video'
            },
            {
                tag: 'Community Impact',
                title: 'OneSBO unites for shoreline outreach',
                excerpt: 'Collaborative drives with partner barangays highlight environmental stewardship and student volunteerism.',
                image: 'group1.jpg',
                link: 'index.html#feature-video'
            },
            {
                tag: 'Student Empowerment',
                title: 'Women of SBO champion inclusive spaces',
                excerpt: 'Trailblazing officers craft programs around wellness, advocacy, and representation across SKSU Isulan.',
                image: 'group2.jpg',
                link: 'index.html#feature-video'
            }
        ];

    const pageContent = document.getElementById('page-content');

        let currentView = 'home';
        let pendingView = null;
        let pendingScroll = null;
        let homeSliderState = null;
        let impactObserver = null;
        let lastTouchEnd = 0;

        function scrollToTarget(id) {
            if (!id) return;
            const target = document.getElementById(id);
            if (target) {
                requestAnimationFrame(() => target.scrollIntoView({ behavior: 'smooth', block: 'start' }));
            }
        }

        function updateActiveLinks(view) {
            document.querySelectorAll('a[data-page]').forEach(link => {
                if (link.dataset.noActive === 'true') {
                    link.classList.remove('active');
                    link.removeAttribute('aria-current');
                    return;
                }
                if (link.dataset.page === view) {
                    link.classList.add('active');
                    link.setAttribute('aria-current', 'page');
                } else {
                    link.classList.remove('active');
                    link.removeAttribute('aria-current');
                }
            });
        }

        function teardownPage(view) {
            if (view === 'home' && homeSliderState?.intervalId) {
                clearInterval(homeSliderState.intervalId);
                homeSliderState = null;
            }
            if (view === 'impact' && impactObserver) {
                impactObserver.disconnect();
                impactObserver = null;
            }
        }

        function initHome(container) {
            const featureEmbed = container.querySelector('[data-feature-embed]');
            const featureFallback = container.querySelector('[data-feature-fallback]');

            if (featureEmbed && featureFallback && featureEmbed.dataset.fallbackBound !== 'true') {
                const fallbackTimer = setTimeout(() => {
                    featureFallback.hidden = false;
                }, 15000);

                const handleSuccess = () => {
                    clearTimeout(fallbackTimer);
                    featureFallback.hidden = true;
                };

                if (featureEmbed.tagName === 'IFRAME') {
                    featureEmbed.addEventListener('load', handleSuccess, { once: true });
                } else if (featureEmbed.tagName === 'VIDEO') {
                    if (featureEmbed.readyState >= 2) {
                        handleSuccess();
                    } else {
                        featureEmbed.addEventListener('loadeddata', handleSuccess, { once: true });
                    }
                    featureEmbed.addEventListener('error', () => {
                        featureFallback.hidden = false;
                    }, { once: true });
                }

                featureEmbed.dataset.fallbackBound = 'true';
            }

            const slider = container.querySelector('[data-home-slider]');
            if (!slider || slider.dataset.initialized === 'true') return;

            const image = slider.querySelector('[data-slide-image]');
            const tagEl = slider.querySelector('[data-slide-tag]');
            const titleEl = slider.querySelector('[data-slide-title]');
            const excerptEl = slider.querySelector('[data-slide-excerpt]');
            const linkEl = slider.querySelector('[data-slide-link]') || slider.querySelector('.showcase-actions a');
            const dotsEl = slider.querySelector('[data-slide-dots]');
            const prevBtn = slider.querySelector('[data-slide-prev]');
            const nextBtn = slider.querySelector('[data-slide-next]');

            let index = 0;
            let intervalId;

            function renderSlide() {
                const slide = homeSlides[index];
                image.src = slide.image;
                image.alt = slide.title;
                tagEl.textContent = slide.tag;
                titleEl.textContent = slide.title;
                excerptEl.textContent = slide.excerpt;
                if (linkEl) linkEl.href = slide.link;
                dotsEl.querySelectorAll('.slide-dot').forEach((dot, dotIndex) => {
                    dot.classList.toggle('active', dotIndex === index);
                });
            }

            function buildDots() {
                dotsEl.innerHTML = '';
                homeSlides.forEach((_, dotIndex) => {
                    const dot = document.createElement('span');
                    dot.className = `slide-dot${dotIndex === index ? ' active' : ''}`;
                    dot.addEventListener('click', () => {
                        index = dotIndex;
                        renderSlide();
                        restartInterval();
                    });
                    dotsEl.appendChild(dot);
                });
            }

            function changeSlide(step) {
                index = (index + step + homeSlides.length) % homeSlides.length;
                renderSlide();
            }

            function restartInterval() {
                clearInterval(intervalId);
                intervalId = setInterval(() => changeSlide(1), 7000);
            }

            prevBtn.addEventListener('click', () => {
                changeSlide(-1);
                restartInterval();
            });

            nextBtn.addEventListener('click', () => {
                changeSlide(1);
                restartInterval();
            });

            buildDots();
            renderSlide();
            intervalId = setInterval(() => changeSlide(1), 7000);
            slider.dataset.initialized = 'true';
            homeSliderState = { intervalId };
        }

        function initImpact(container) {
            const metrics = Array.from(container.querySelectorAll('[data-metric-target]'));
            if (!metrics.length) return;
            metrics.forEach(metric => { metric.textContent = '0'; });

            impactObserver = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (!entry.isIntersecting) return;
                    const el = entry.target;
                    const targetValue = Number(el.dataset.metricTarget || '0');
                    const start = performance.now();
                    const duration = 1800;

                    function step(now) {
                        const progress = Math.min((now - start) / duration, 1);
                        el.textContent = Math.floor(progress * targetValue).toLocaleString('en-US');
                        if (progress < 1) requestAnimationFrame(step);
                    }

                    requestAnimationFrame(step);
                    impactObserver.unobserve(el);
                });
            }, { threshold: 0.5 });

            metrics.forEach(metric => impactObserver.observe(metric));
        }

        function initConnect(container) {
            const form = container.querySelector('#contact-form');
            if (!form || form.dataset.bound === 'true') return;
            form.addEventListener('submit', event => {
                event.preventDefault();
                form.reset();
                alert('Thank you for reaching out! The SBO team will respond within two working days.');
            });
            form.dataset.bound = 'true';
        }

        function initNewsroom(container) {
            const buttons = container.querySelectorAll('[data-detail-toggle]');
            buttons.forEach(button => {
                if (button.dataset.bound === 'true') return;
                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-detail-toggle');
                    const detail = container.querySelector(`#${targetId}`);
                    if (!detail) return;
                    const isHidden = detail.getAttribute('aria-hidden') !== 'false';
                    detail.setAttribute('aria-hidden', isHidden ? 'false' : 'true');
                    button.textContent = isHidden ? 'Hide full story' : 'Read full story';
                });
                button.dataset.bound = 'true';
            });
        }

        function initPage(view, container) {
            if (!container) return;
            switch (view) {
                case 'home':
                    initHome(container);
                    break;
                case 'impact':
                    initImpact(container);
                    break;
                case 'connect':
                    initConnect(container);
                    break;
                case 'newsroom':
                    initNewsroom(container);
                    break;
                default:
                    break;
            }
        }

        function loadView(view, options = {}) {
            const { scrollTarget = null, navigationMode = 'push' } = options;
            const config = viewConfig[view];

            if (!config) {
                if (view === 'home' && scrollTarget) {
                    if (navigationMode === 'push') {
                        history.pushState({ view, scrollTarget }, '', `#${scrollTarget}`);
                    } else if (navigationMode === 'replace') {
                        history.replaceState({ view, scrollTarget }, '', `#${scrollTarget}`);
                    }
                    scrollToTarget(scrollTarget);
                }
                return;
            }

            if (view === currentView) {
                if (scrollTarget) {
                    if (navigationMode === 'push') {
                        history.pushState({ view, scrollTarget }, '', `#${scrollTarget}`);
                    } else if (navigationMode === 'replace') {
                        history.replaceState({ view, scrollTarget }, '', `#${scrollTarget}`);
                    }
                    scrollToTarget(scrollTarget);
                }
                updateActiveLinks(view);
                return;
            }

            updateActiveLinks(view);

            if (navigationMode === 'push') {
                if (view === 'home' && !scrollTarget) {
                    history.pushState({ view }, '', window.location.pathname + window.location.search);
                } else {
                    const hashValue = scrollTarget || view;
                    history.pushState({ view, scrollTarget }, '', `#${hashValue}`);
                }
            } else if (navigationMode === 'replace') {
                const hashValue = scrollTarget || view;
                const url = view === 'home' && !scrollTarget
                    ? window.location.pathname + window.location.search
                    : `#${hashValue}`;
                history.replaceState({ view, scrollTarget }, '', url);
            }

            pendingView = view;
            pendingScroll = scrollTarget;
            pageContent.style.opacity = '0.35';
            pageContent.setAttribute('aria-busy', 'true');
            htmx.ajax('GET', config.partial, '#page-content');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const initialHash = window.location.hash.replace('#', '');

            if (initialHash && viewConfig[initialHash]) {
                loadView(initialHash, { navigationMode: 'replace' });
            } else {
                if (!history.state || !history.state.view) {
                    const url = initialHash
                        ? `#${initialHash}`
                        : window.location.pathname + window.location.search;
                    history.replaceState({ view: currentView, scrollTarget: initialHash || null }, '', url);
                }
                updateActiveLinks(currentView);
                initPage(currentView, pageContent);
                if (initialHash) {
                    scrollToTarget(initialHash);
                }
            }
            trackPageView();
        });

        document.addEventListener('touchstart', event => {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });
        document.addEventListener('touchend', event => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });

        document.addEventListener('click', event => {
            const link = event.target.closest('a[data-page]');
            if (!link) return;
            if (event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) return;

            const page = link.dataset.page;
            const scrollTarget = link.dataset.scrollTarget || null;

            if (!viewConfig[page]) {
                if (page === 'home' && scrollTarget) {
                    event.preventDefault();
                    history.pushState({ view: 'home', scrollTarget }, '', `#${scrollTarget}`);
                    scrollToTarget(scrollTarget);
                }
                return;
            }

            event.preventDefault();
            loadView(page, { scrollTarget });
        });

        window.addEventListener('popstate', event => {
            const stateView = event.state?.view;
            const stateScroll = event.state?.scrollTarget || null;
            const hash = window.location.hash.replace('#', '');
            const targetView = stateView || (viewConfig[hash] ? hash : 'home');

            if (viewConfig[targetView]) {
                loadView(targetView, { scrollTarget: stateScroll || null, navigationMode: 'none' });
            } else if (hash) {
                scrollToTarget(hash);
            } else {
                loadView('home', { navigationMode: 'none' });
            }
        });

        document.body.addEventListener('htmx:afterSwap', event => {
            if (event.detail.target !== pageContent) return;
            const previousView = currentView;
            currentView = pendingView || currentView;
            pendingView = null;
            pageContent.style.opacity = '1';
            pageContent.removeAttribute('aria-busy');
            if (previousView !== currentView) {
                teardownPage(previousView);
            }
            updateActiveLinks(currentView);
            initPage(currentView, pageContent);
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if (pendingScroll) {
                scrollToTarget(pendingScroll);
                pendingScroll = null;
            }
            trackPageView();
        });

        document.body.addEventListener('htmx:responseError', event => {
            if (event.detail.target !== pageContent) return;
            pageContent.style.opacity = '1';
            pageContent.removeAttribute('aria-busy');
            pageContent.innerHTML = '<div class="load-error">We could not load that section. Please try again.</div>';
            pendingView = null;
            pendingScroll = null;
        });
    </script>
    <!-- Analytics auto-enabled (consent persisted as 'granted') -->
    <script>
        (function () {
            const ACCEPT_KEY = 'sbo_analytics_consent_v1';
            try { localStorage.setItem(ACCEPT_KEY, 'granted'); } catch (e) { /* ignore */ }
            window.analytics = window.analytics || { enabled: true };
            if (typeof window.loadGtag === 'function') {
                window.loadGtag();
                if (typeof window.trackPageView === 'function') window.trackPageView();
            }
        })();
    </script>
</body>
</html>
